{"version":3,"sources":["webpack:///./src/views/Comment.vue","webpack:///./src/components/SendComment.vue","webpack:///src/components/SendComment.vue","webpack:///./src/components/SendComment.vue?49c4","webpack:///./src/components/SendComment.vue?cafc","webpack:///./src/components/CommentComponent.vue","webpack:///src/components/CommentComponent.vue","webpack:///./src/components/CommentComponent.vue?a2e2","webpack:///./src/components/CommentComponent.vue?acfa","webpack:///src/views/Comment.vue","webpack:///./src/views/Comment.vue?8c12","webpack:///./src/views/Comment.vue?f271","webpack:///./src/components/SendComment.vue?75ed","webpack:///./src/components/CommentComponent.vue?10e6"],"names":["render","_vm","this","_c","_self","attrs","playNow","platform","id","comments","initComments","staticRenderFns","class","commentInfo","open","staticClass","commentId","_e","staticStyle","_v","_s","title","nick","directives","name","rawName","value","val","expression","domProps","on","$event","target","composing","$set","closeComment","clickPlane","props","successCb","type","data","loading","computed","mapGetters","methods","api","method","content","biztype","request","t","cache","trueType","success","component","show","onScroll","_l","length","key","toUpperCase","item","user","avatarUrl","userId","nickname","getTime","time","beReplied","newLike","liked","likeComment","numberHandle","likedCount","reply","canDelete","delComment","commentType","playingPercent","watch","handler","deep","created","setTimeout","confirm","cb","res","console","getComments","total","offset","init","pageNo","limit","comment","cid","components","SendComment","CommentComponent"],"mappings":"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","file":"js/chunk-aa1cb3a0.ec7f0af4.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('block',[_c('CommentComponent',{attrs:{\"platform\":_vm.playNow.platform || '163',\"comment-type\":0,\"id\":_vm.playNow.id,\"comments\":_vm.comments}}),_c('SendComment',{attrs:{\"type\":0,\"platform\":_vm.playNow.platform || '163',\"success-cb\":_vm.initComments}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{class:`write-comment-container ${_vm.commentInfo.open && 'open'}`},[_c('div',{staticClass:\"comment-main\"},[(!_vm.commentInfo.commentId)?_c('div',{staticClass:\"ft_14 pl_5\",staticStyle:{\"color\":\"#fff9\",\"line-height\":\"20px\"}},[_vm._v(\" 为 \"),_c('span',{staticClass:\"comment-title\"},[_vm._v(_vm._s(_vm.commentInfo.title))]),_vm._v(\" 献上评论\")]):_vm._e(),(_vm.commentInfo.commentId)?_c('div',{staticClass:\"ft_14 pl_5\",staticStyle:{\"color\":\"#fff9\",\"line-height\":\"20px\"}},[_vm._v(\" 回复 @\"),_c('span',{staticClass:\"comment-title\"},[_vm._v(_vm._s(_vm.commentInfo.nick))])]):_vm._e(),_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.commentInfo.val),expression:\"commentInfo.val\"}],staticClass:\"comment-input\",attrs:{\"rows\":2,\"placeholder\":\"说些啥呢\"},domProps:{\"value\":(_vm.commentInfo.val)},on:{\"input\":function($event){if($event.target.composing)return;_vm.$set(_vm.commentInfo, \"val\", $event.target.value)}}})]),_c('i',{staticClass:\"iconfont icon-cancel pointer\",on:{\"click\":_vm.closeComment}}),_c('div',{staticClass:\"plane-icon\",on:{\"click\":_vm.clickPlane}},[_c('i',{staticClass:\"iconfont icon-plane pointer\"})])])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div :class=\"`write-comment-container ${commentInfo.open && 'open'}`\">\n    <div class=\"comment-main\">\n      <div v-if=\"!commentInfo.commentId\" class=\"ft_14 pl_5\" style=\"color: #fff9; line-height: 20px\"> 为 <span class=\"comment-title\">{{commentInfo.title}}</span> 献上评论</div>\n      <div v-if=\"commentInfo.commentId\" class=\"ft_14 pl_5\" style=\"color: #fff9; line-height: 20px\"> 回复 @<span class=\"comment-title\">{{commentInfo.nick}}</span> </div>\n      <textarea\n        class=\"comment-input\"\n        :rows=\"2\"\n        placeholder=\"说些啥呢\"\n        v-model=\"commentInfo.val\">\n      </textarea>\n    </div>\n    <i class=\"iconfont icon-cancel pointer\" @click=\"closeComment\"></i>\n    <div class=\"plane-icon\" @click=\"clickPlane\">\n      <i class=\"iconfont icon-plane pointer\" />\n    </div>\n  </div>\n</template>\n\n<script>\n  import { mapGetters } from 'vuex';\n  import request from '../assets/utils/request';\n\n  export default {\n    name: \"SendComment\",\n    props: {\n      successCb: Function,\n      type: Number,\n      platform: String,\n    },\n    data() {\n      return {\n        loading: false,\n      }\n    },\n    computed: {\n      ...mapGetters({\n        commentInfo: 'getCommentInfo',\n        playNow: 'getPlaying',\n      })\n    },\n    methods: {\n      clickPlane() {\n        const { commentInfo, platform, type } = this;\n        let trueType = type;\n        let id = 0, title = commentInfo.title;\n        if (commentInfo.open) {\n          // 这里是发送评论\n          if (!commentInfo.val) {\n            return this.$message.warning('无话可说？');\n          } else if (commentInfo.val.length > 300) {\n            return this.$message.warning('话有点多？');\n          } else {\n            if (this.loading) {\n              return;\n            }\n            // 真的要发评论了\n            this.loading = true;\n            if (commentInfo.platform === 'qq') {\n              return request({\n                api: 'QQ_COMMENT_SEND',\n                method: 'post',\n                data: {\n                  id: commentInfo.id,\n                  content: commentInfo.val,\n                  biztype: commentInfo.type,\n                }\n              }).then(() => {\n                this.loading = false;\n                this.successCb();\n              }, () => this.$message.error('评论失败了'));\n            }\n            request({\n              api: 'COMMENT',\n              data: {\n                t: commentInfo.commentId ? 2 : 1,\n                type,\n                id: commentInfo.id,\n                content: commentInfo.val,\n                commentId: commentInfo.commentId,\n              },\n              cache: true,\n            }).then(() => {\n              this.loading = false;\n              this.successCb();\n            }, () => this.$message.error('评论失败了'));\n          }\n        } else {\n          switch (`${platform}-${type}`) {\n            case '163-0':\n              id = this.playNow.id;\n              title = this.playNow.name;\n              break;\n            case 'qq-0':\n              id = this.playNow.songid;\n              title = this.playNow.name;\n              trueType = 1;\n              break;\n          }\n          this.$store.dispatch('updateCommentInfo', { type: trueType, id, title, open: true, platform, success: false, });\n        }\n      },\n      closeComment() {\n        this.$store.dispatch('updateCommentInfo', { open: false });\n      }\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .write-comment-container {\n    position: fixed;\n    bottom: 120px;\n    right: 40px;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    background: #F23C3C;\n    border: 2px solid #F23C3C;\n    opacity: 0.3;\n    font-size: 0;\n    cursor: pointer;\n    box-shadow: 0 0 20px #333;\n    transition: 0.3s;\n    overflow: hidden;\n    z-index: 10;\n\n    &:hover {\n      opacity: 0.8;\n    }\n\n    &.open {\n      opacity: 0.8;\n      width: calc(40% - 80px);\n      height: 120px;\n      background: #000d;\n      border: 2px solid #fff3;\n      border-radius: 20px;\n      cursor: default;\n      z-index: 10;\n\n      .comment-main, .icon-cancel {\n        opacity: 1;\n      }\n      .plane-icon {\n        bottom: 5px;\n      }\n    }\n\n    .plane-icon {\n      color: #fff;\n      text-align: center;\n      position: absolute;\n      right: 0;\n      bottom: 0;\n      width: 50px;\n      transition: 0.3s;\n\n      .icon-plane {\n        line-height: 50px;\n        font-size: 24px !important;\n      }\n    }\n\n    .icon-cancel {\n      position: absolute;\n      bottom: 80px;\n      right: 20px;\n      color: #fffc;\n      font-size: 14px !important;\n      transition: 0.3s;\n      opacity: 0;\n    }\n\n    .comment-main {\n      position: absolute;\n      right: 65px;\n      bottom: 15px;\n      width: calc(100% - 80px);\n      color: #fffc;\n      transition: 0.3s;\n      opacity: 0;\n\n      .comment-title {\n        display: inline-block;\n        max-width: 150px;\n        overflow: hidden;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n        vertical-align: -6px;\n      }\n\n      .comment-input {\n        background: transparent !important;\n        width: 100%;\n        height: 70px;\n        font-size: 14px;\n        border: none !important;\n        color: #fffc;\n        outline: none !important;\n        resize: none;\n      }\n    }\n  }\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./SendComment.vue?vue&type=template&id=fe07b3e8&scoped=true&\"\nimport script from \"./SendComment.vue?vue&type=script&lang=js&\"\nexport * from \"./SendComment.vue?vue&type=script&lang=js&\"\nimport style0 from \"./SendComment.vue?vue&type=style&index=0&id=fe07b3e8&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"fe07b3e8\",\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{class:`comments-page-container ${_vm.show && 'show'}`,on:{\"scroll\":_vm.onScroll}},_vm._l((_vm.type),function(t){return (_vm.comments && (_vm.comments[t].length > 0))?_c('div',{key:`list-${t}`,staticClass:\"comment-type-block\"},[_c('div',{staticClass:\"comment-type-title\"},[_vm._v(_vm._s(t.toUpperCase()))]),_c('div',{staticClass:\"comments-list\"},_vm._l((_vm.comments[t]),function(item){return _c('div',{key:item.id,staticClass:\"comment-item\"},[_c('img',{staticClass:\"user-avatar\",attrs:{\"src\":`${item.user.avatarUrl}?param=50y50`}}),_c('div',{staticClass:\"comment-content\"},[_c('div',{staticClass:\"user-name-block\"},[_c('a',{attrs:{\"href\":`#/user?id=${item.user.userId}`}},[_c('b',{staticClass:\"user-name\"},[_vm._v(_vm._s(item.user.nickname))])]),_c('span',{staticClass:\"pl_20 comment-time\"},[_vm._v(_vm._s(_vm.getTime(item.time)))])]),_c('div',{staticClass:\"content\",domProps:{\"innerHTML\":_vm._s(item.content)}}),(item.beReplied && item.beReplied[0])?_c('blockquote',{staticClass:\"be-replied\"},[_c('a',{staticClass:\"user-name\",attrs:{\"href\":`#/user?id=${item.user.userId}`}},[_vm._v(\"@\"+_vm._s(item.beReplied[0].user.nickname))]),_vm._v(\"\\n            ：\"),_c('span',{domProps:{\"innerHTML\":_vm._s(item.beReplied[0].content)}})]):_vm._e(),_c('div',{staticClass:\"mt_10\"},[_c('i',{class:`iconfont pointer ${item.newLike} icon-zan${item.liked ? '' : '-o'}`,on:{\"click\":function($event){return _vm.likeComment(item, t)}}}),_c('span',{staticClass:\"pl_10 ft_12\"},[_vm._v(_vm._s(_vm.numberHandle(item.likedCount)))]),(_vm.platform === '163')?_c('i',{staticClass:\"iconfont icon-reply ml_20 pointer\",staticStyle:{\"vertical-align\":\"-1px\"},on:{\"click\":function($event){return _vm.reply(item)}}}):_vm._e(),(item.canDelete || (_vm.platform === '163' && item.user.userId === _vm.user.userId))?_c('i',{staticClass:\"iconfont icon-delete ml_20 pointer\",on:{\"click\":function($event){return _vm.delComment(item.commentId)}}}):_vm._e()])])])}),0)]):_vm._e()}),0)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div :class=\"`comments-page-container ${show && 'show'}`\" @scroll=\"onScroll\">\n    <div class=\"comment-type-block\" v-if=\"comments && (comments[t].length > 0)\" v-for=\"t in type\" :key=\"`list-${t}`\">\n      <div class=\"comment-type-title\">{{t.toUpperCase()}}</div>\n      <div class=\"comments-list\">\n        <div class=\"comment-item\" v-for=\"item in comments[t]\" :key=\"item.id\">\n          <img class=\"user-avatar\" :src=\"`${item.user.avatarUrl}?param=50y50`\">\n          <div class=\"comment-content\">\n            <div class=\"user-name-block\">\n              <a :href=\"`#/user?id=${item.user.userId}`\"><b class=\"user-name\">{{item.user.nickname}}</b></a>\n              <span class=\"pl_20 comment-time\">{{getTime(item.time)}}</span>\n            </div>\n            <div class=\"content\" v-html=\"item.content\"></div>\n            <blockquote v-if=\"item.beReplied && item.beReplied[0]\" class=\"be-replied\">\n              <a :href=\"`#/user?id=${item.user.userId}`\" class=\"user-name\">@{{item.beReplied[0].user.nickname}}</a>\n              ：<span v-html=\"item.beReplied[0].content\"></span>\n            </blockquote>\n            <div class=\"mt_10\">\n              <i @click=\"likeComment(item, t)\" :class=\"`iconfont pointer ${item.newLike} icon-zan${item.liked ? '' : '-o'}`\" />\n              <span class=\"pl_10 ft_12\">{{numberHandle(item.likedCount)}}</span>\n              <i v-if=\"platform === '163'\" class=\"iconfont icon-reply ml_20 pointer\" style=\"vertical-align: -1px;\" @click=\"reply(item)\" />\n              <i class=\"iconfont icon-delete ml_20 pointer\" @click=\"delComment(item.commentId)\" v-if=\"item.canDelete || (platform === '163' && item.user.userId === user.userId)\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n  import request, { handleQQComments } from '../assets/utils/request';\n  import timer from '../assets/utils/timer';\n  import { numToStr } from \"../assets/utils/stringHelper\";\n  import { mapGetters } from 'vuex';\n  import $ from 'jquery';\n  import Storage from \"../assets/utils/Storage\";\n  export default {\n    name: \"Comment\",\n    props: {\n      commentType: Number,\n      id: Number | String,\n      comments: Object,\n      platform: String,\n    },\n    data() {\n      return {\n        loading: false,\n        show: false,\n        type: ['hot', 'latest'],\n      }\n    },\n    computed: {\n      ...mapGetters({\n        playNow: 'getPlaying',\n        user: 'getUser',\n        playingPercent: 'getPlayingPercent',\n        commentInfo: 'getCommentInfo',\n      })\n    },\n    watch: {\n      commentInfo: {\n        handler(v) {\n          if (v.success) {\n            this.getComments(true);\n          }\n        },\n        deep: true,\n      }\n    },\n    created() {\n      setTimeout(() => this.show = true);\n    },\n    methods: {\n      async delComment(commentId) {\n        const { id, commentType, playNow } = this;\n        const { comments } = [playNow][commentType];\n        try {\n          const confirm = await this.$confirm('确认删除？');\n          if (confirm !== 'confirm') {\n            return;\n          }\n          const cb = () => {\n            comments.hot = comments.hot.filter((item) => item.commentId !== commentId);\n            comments.latest = comments.latest.filter((item) => item.commentId !== commentId);\n            comments.total -= 1;\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n            this.$message.success('删除成功');\n          };\n          if (this.platform === 'qq') {\n            return request({\n              api: 'QQ_COMMENT_DELETE',\n              data: { id: commentId }\n            }).then(cb, () => this.$message.error('删除失败'));\n          }\n          const res = await request({\n            api: 'COMMENT',\n            data: {\n              t: 0,\n              type: commentType,\n              id,\n              commentId,\n            },\n            cache: true,\n          });\n          (res.code === 200) ? cb() : this.$message.error('删除失败');\n        } catch (err) {\n          console.log(err);\n        }\n      },\n      async reply(beReplied) {\n        const { commentId, user } = beReplied;\n        const { id, platform } = this;\n        this.$store.dispatch('updateCommentInfo', { type: 0, id, commentId, open: true, nick: user.nickname, beReplied, platform });\n      },\n      // 获取评论\n      getComments(init) {\n        const { playNow, commentType } = this;\n        const { comments, id } = [playNow][commentType];\n        if (!comments) {\n          return false;\n        }\n        let { offset, total } = comments;\n        if (init) {\n          offset = 0;\n        }\n        const limit = 20;\n        if (((offset + limit) > total) || this.loading) {\n          return;\n        }\n        this.loading = true;\n\n        init && (comments.latest = []);\n        if (this.platform === 'qq') {\n          request({\n            api: 'QQ_GET_COMMENT',\n            data: {\n              id: playNow.songid,\n              pageNo: offset / 20 + 1,\n            },\n          }).then((res) => {\n            comments.offset += limit;\n            comments.total = res.data.comment.commenttotal;\n            comments.latest = [ ...comments.latest, ...handleQQComments(res.data.comment.commentlist)];\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n            this.loading = false;\n          })\n        } else {\n          request({\n            api: ['MUSIC_COMMENTS'][commentType],\n            data: { offset, limit: 20, total, id }\n          }).then((res) => {\n            comments.offset += limit;\n            comments.total = res.total;\n            comments.latest = [ ...comments.latest, ...res.comments ];\n            this.loading = false;\n            this.$store.dispatch(['updateSongDetail'][commentType], { id, comments });\n          })\n        }\n      },\n      onScroll() {\n        const { comments, loading } = this;\n        if (!comments) {\n          return;\n        }\n        const { offset, total } = comments;\n        const el = $('.comments-page-container');\n        const viewH = el.height(); // 可见高度\n        const contentH = el.get(0).scrollHeight; // 内容高度\n        const scrollTop = el.scrollTop(); // 滚动高度\n        if (contentH - viewH - scrollTop < 300 && offset < total && !loading) {\n          this.getComments();\n        }\n      },\n      getTime(t) {\n        return timer(t).str('YY-MM-DD HH:mm:ss');\n      },\n      numberHandle: numToStr,\n      likeComment(c, type) {\n        const { playNow, commentType } = this;\n        const t = Number(!c.liked);\n        const cb = () => {\n          const comment = [playNow][commentType].comments[type].find((cItem) => cItem.commentId === c.commentId);\n          comment.likedCount += t * 2 - 1;\n          comment.liked = !c.liked;\n          comment.newLike = !c.liked ? '' : 'new-like';\n          this.$store.dispatch(['updateSongDetail'][commentType], playNow);\n        }\n        if (this.platform === 'qq') {\n          if (Storage.get('haveQCookie') !== '1') {\n            return this.$message.warning('请先前往设置页设置 Cookie');\n          }\n          return request({\n            api: 'QQ_COMMENT_LIKE',\n            data: {\n              id: c.commentId,\n              type: t * -1 + 2,\n            }\n          }).then(cb)\n        }\n        request({\n          api: 'LIKE_COMMENT',\n          data: {\n            t,\n            type: commentType,\n            cid: c.commentId,\n            id: this.id,\n          }\n        }).then((res) => {\n          res && cb();\n        })\n      },\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  .comments-page-container {\n    width: 40%;\n    position: absolute;\n    height: calc(100% - 50px);\n    min-height: 550px;\n    left: 110%;\n    overflow: auto;\n    background: #0001;\n    border-left: 1px solid #fff8;\n    transition: 0.3s;\n    opacity: 0;\n    top: 40px;\n\n\n    &.show {\n      left: 60%;\n      opacity: 1;\n    }\n\n    &::-webkit-scrollbar {\n      width: 0;\n      height:8px;\n      background-color:rgba(0,0,0,0);\n    }\n\n    .comment-type-block {\n      .comment-type-title {\n        height: 20px;\n        font-size: 100px;\n        color: #fff2;\n        font-weight: bold;\n      }\n\n      .comments-list {\n        padding-top: 50px;\n        .comment-item {\n          margin-bottom: 10px;\n          color: #fffa;\n          padding: 15px 10px;\n          background: #0002;\n          width: calc(100% - 60px);\n          margin-left: 20px;\n          border-radius: 10px;\n          transition: 0.5s;\n\n          &:hover {\n            background: #0004;\n            color: #fff;\n          }\n\n          .user-avatar {\n            width: 50px;\n            height: 50px;\n            border-radius: 50%;\n            margin-top: 5px;\n          }\n\n          .comment-content {\n            width: calc(100% - 80px);\n            display: inline-block;\n            vertical-align: top;\n            padding-left: 20px;\n\n            .user-name {\n              cursor: pointer;\n              &:hover {\n                text-decoration: underline;\n              }\n            }\n\n            .user-name-block {\n              font-weight: bold;\n              font-size: 18px;\n              opacity: 0.7;\n\n              .comment-time {\n                font-size: 12px;\n                font-weight: normal;\n              }\n            }\n            .content {\n              margin-top: 10px;\n              opacity: 0.7;\n            }\n            .be-replied {\n              margin-top: 5px;\n              padding: 5px 10px;\n              border-left: 5px solid #fff8;\n              opacity: 0.7;\n            }\n          }\n\n          .iconfont.new-like {\n            animation: likeAnimation 0.5s;\n\n            @keyframes likeAnimation {\n              from, to {\n                transform: rotate(0deg);\n              }\n              50% {\n                transform: rotate(-30deg);\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./CommentComponent.vue?vue&type=template&id=0c68a496&scoped=true&\"\nimport script from \"./CommentComponent.vue?vue&type=script&lang=js&\"\nexport * from \"./CommentComponent.vue?vue&type=script&lang=js&\"\nimport style0 from \"./CommentComponent.vue?vue&type=style&index=0&id=0c68a496&prod&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0c68a496\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <block>\n    <CommentComponent :platform=\"playNow.platform || '163'\" :comment-type=\"0\" :id=\"playNow.id\" :comments=\"comments\" />\n    <SendComment :type=\"0\" :platform=\"playNow.platform || '163'\" :success-cb=\"initComments\" />\n  </block>\n</template>\n\n<script>\n  import { mapGetters } from 'vuex';\n  import request from '../assets/utils/request';\n  import timer from '../assets/utils/timer';\n  import SendComment from '../components/SendComment';\n  import CommentComponent from '../components/CommentComponent';\n  import $ from 'jquery';\n  export default {\n    name: \"Comment\",\n    components: { SendComment, CommentComponent },\n    data() {\n      return {\n        comments: null,\n        loading: false,\n        type: ['hot', 'latest'],\n        show: false,\n      }\n    },\n    computed: {\n      ...mapGetters({\n        playNow: 'getPlaying',\n        user: 'getUser',\n      })\n    },\n    watch: {\n      playNow({ comments }) {\n        this.comments = comments;\n      }\n    },\n    created() {\n      this.comments = this.playNow.comments;\n      this.$store.dispatch('updateCommentInfo', { type: 0, id: 0, val: '', title: '', open: false });\n    },\n    methods: {\n      initComments() {\n        this.$message.success('发送成功~');\n        this.$store.dispatch('updateCommentInfo', { type: 0, id: 0, val: '', title: '', open: false, success: true, });\n      },\n    }\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Comment.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Comment.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Comment.vue?vue&type=template&id=5f230c2c&scoped=true&\"\nimport script from \"./Comment.vue?vue&type=script&lang=js&\"\nexport * from \"./Comment.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5f230c2c\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./SendComment.vue?vue&type=style&index=0&id=fe07b3e8&prod&lang=scss&scoped=true&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./CommentComponent.vue?vue&type=style&index=0&id=0c68a496&prod&lang=scss&scoped=true&\""],"sourceRoot":""}